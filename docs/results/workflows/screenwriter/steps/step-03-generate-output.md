# Step 03: Generate Output Files

**Goal:** Create final screenplay file and tracking YAML, update pipeline state.

**Scope:** File creation and pipeline update.

**Token Budget:** ~350 tokens

---

## OUTPUT FILE CREATION

### File A: Screenplay Markdown

**File path:** `{project-root}/.bmad/creative-studio/workflows/screenwriter/outputs/screenplay-{timestamp}.md`

**Timestamp format:** ISO8601 with hyphens: `YYYY-MM-DDTHH-MM-SSZ`

**Content structure:**

```markdown
# Screenplay: [Title]

## Metadata

- **Total Scenes:** {count}
- **Estimated Duration:** {X} minutes
- **Characters:** {comma-separated list}
- **Primary Locations:** {count} locations
- **Format Version:** standard_hollywood
- **Generated:** {timestamp}

## Characters

### {Character Name}
**First Appearance:** Scene {N}
**Description:** {Visual description from first appearance}

[Repeat for each character]

## Screenplay

FADE IN:

<!-- Scene 1 -->
<scene number="1" duration="45s">
  <slugline>EXT. FROZEN BEACH - DAWN</slugline>
  <location>Frozen Beach</location>
  <time>Dawn</time>
  <characters>Sarah</characters>
  <mood>melancholic, yearning</mood>
  <key_visuals>
    <visual>frozen shoreline with ice crystal formations</visual>
    <visual>woman in heavy wool coat, wind-blown hair</visual>
    <visual>pale winter sunrise over grey sea</visual>
  </key_visuals>
  <action>
Gray ice stretches to the horizon. The sea has frozen mid-wave, creating sculptural formations along the shore.

SARAH (38, weathered but elegant, wearing a heavy wool coat) stands alone at the water's edge. Wind whips her dark hair across her face. She doesn't brush it away.

Her eyes fix on the horizon‚Äîthe direction ships disappear.
  </action>
</scene>

---

<!-- Scene 2 -->
<scene number="2" duration="30s">
  [Continue for all scenes...]
</scene>

---

[All scenes...]

FADE OUT.

---

## Production Notes

### Locations Summary
| Location | INT/EXT | Scenes Used | Notes |
|----------|---------|-------------|-------|
| Frozen Beach | EXT | 1, 5, 12 | Requires ice/snow |
| Apartment | INT | 2, 6, 9 | Shrine corner setup |

### Props List
- Worn leather jacket (male)
- Heavy wool coat (female)
- Candles and small mementos (shrine)
[Complete list]

### Visual Consistency Notes
[Any notes about maintaining visual coherence]

---

*Generated by Screenwriter Workflow*
*Ready for: Production Validator*
```

### File B: Tracking YAML

**File path:** `{project-root}/.bmad/creative-studio/_state/screenwriter-{timestamp}.yaml`

**Content (matching handoff-schema.yaml):**

```yaml
---
# Creative Pipeline State - screenwriter
workflow_stage: 03-screenwriter
next_stage: 04-production-validator
status: completed
created_at: "{timestamp}"
user_name: "{user_name}"

# Input Reference
input_from: "02-storyteller"
input_tracking_file: "_state/storyteller-{previous_timestamp}.yaml"

# Output Reference
screenplay_file: "workflows/screenwriter/outputs/screenplay-{timestamp}.md"

# === HANDOFF METADATA FOR PRODUCTION-VALIDATOR ===
# Reference: _state/handoff-schema.yaml ‚Üí screenwriter_to_production_validator

# Format info
format_version: "standard_hollywood"
xml_tagged: true

# Scene data
scene_count: {number}
total_duration_estimate: "{X} minutes"

# Location list (for production planning)
location_list:
  - name: "Frozen Beach"
    type: "EXT"
    scenes: [1, 5, 12]
    notes: "Requires ice/snow environment"
  - name: "Apartment"
    type: "INT"
    scenes: [2, 6, 9]
    notes: "Shrine corner setup needed"

# Props list
prop_list:
  - item: "Worn leather jacket"
    description: "Male jacket, oversized for female character"
    scenes: [1, 5, 12]
  - item: "Heavy wool coat"
    description: "Dark color, worn by Sarah"
    scenes: [1, 3, 5, 12]

# Characters for casting
characters:
  - name: "Sarah"
    description: "38, weathered but elegant"
    scenes: [1, 2, 3, 5, 6, 9, 12]
    has_dialogue: false

# Quality markers
visual_enhancement_applied: true
key_visuals_per_scene: 3-5

# Pipeline control
ready_for_next_stage: true

---
```

---

## UPDATE PIPELINE STATE

Use the **Edit** tool to update `creative-pipeline-state.yaml`:

**Find (old_string):**
```yaml
  - stage: 03-screenwriter
    status: ready
    input_from: "02-storyteller"
    waiting_for_user: false
```

**Replace with (new_string):**
```yaml
  - stage: 03-screenwriter
    status: completed
    input_from: "02-storyteller"
    output_file: "workflows/screenwriter/outputs/screenplay-{timestamp}.md"
    tracking_file: "_state/screenwriter-{timestamp}.yaml"
    completed_at: "{timestamp}"
```

**THEN update stage 04:**
```yaml
  - stage: 04-production-validator
    status: ready
    input_from: "03-screenwriter"
    waiting_for_user: false
```

**THEN update Quick Access:**
```yaml
current_stage: "04-production-validator"
last_output: "workflows/screenwriter/outputs/screenplay-{timestamp}.md"
next_stage_ready: true
```

---

## WORKFLOW COMPLETION

### Summary for User

```
‚úÖ Screenplay Formatting Complete!

üìÑ Screenplay: {file_path}
üé¨ Total Scenes: {count}
‚è±Ô∏è Estimated Duration: {duration}
üìç Locations: {location_count}
üé≠ Characters: {character_list}

FORMATTING APPLIED:
- Professional sluglines (INT/EXT. LOCATION - TIME)
- Visual-rich action lines
- XML tags for pipeline parsing
- Key visuals for each scene
- Props and locations documented

NEXT STEP OPTIONS:

1. **Continue to Production Validator**
   Verify screenplay is ready for image/video generation

2. **Review Screenplay**
   Read through the formatted screenplay

3. **Request Revisions**
   Ask for changes to specific scenes

4. **Exit Pipeline**
   Save progress and exit

What would you like to do?
```

---

## COMPLETION CHECKLIST

Before marking complete:

- [ ] Screenplay file written with all scenes
- [ ] All scenes have XML tags and key visuals
- [ ] Tracking YAML created with ALL handoff fields
- [ ] Location and prop lists compiled
- [ ] Pipeline state updated
- [ ] User presented with summary

---

**Screenwriter workflow complete. Ready for production-validator or user exit.**
